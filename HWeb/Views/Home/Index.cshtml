@model List<HWeb.Models.Product>
@{
    ViewData["Title"] = "Trang chủ";
}

<!-- Hero Banner -->
<div class="hero-banner bg-light py-5 mb-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold text-primary">HWeb Fashion</h1>
                <p class="lead">Chào mừng đến với cửa hàng thời trang hàng đầu. Khám phá bộ sưu tập áo sơ mi, quần tây và chân váy cao cấp với phong cách hiện đại và chất lượng tuyệt vời.</p>
                <div class="mt-4">
                    <a asp-controller="Products" asp-action="Index" class="btn btn-primary btn-lg me-3">
                        Mua sắm ngay
                    </a>
                    <a asp-controller="Products" asp-action="Index" class="btn btn-outline-primary btn-lg">
                        Xem bộ sưu tập
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="text-center">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 300px; height: 300px;">
                        <i class="fas fa-tshirt text-white" style="font-size: 8rem;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Featured Products -->
@if (Model != null && Model.Any())
{
    <div class="container mb-5">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h2 class="fw-bold">Sản phẩm nổi bật</h2>
                <p class="text-muted">Khám phá các sản phẩm thời trang chất lượng cao</p>
            </div>
        </div>
        <div class="row g-4">
            @foreach (var product in Model)
            {
                <div class="col-lg-3 col-md-6">
                    <div class="card h-100 shadow-sm product-card">
                        <div class="product-image-container">
                            @if (!string.IsNullOrEmpty(product.ImageUrl))
                            {
                                <img src="@product.ImageUrl" 
                                     alt="@product.Name" 
                                     class="card-img-top product-image">
                            }
                            else
                            {
                                <div class="placeholder-image d-flex align-items-center justify-content-center">
                                    <i class="fas fa-image text-muted" style="font-size: 3rem;"></i>
                                </div>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" 
                                   class="text-decoration-none text-dark">
                                    @product.Name
                                </a>
                            </h5>
                            @if (product.Category != null)
                            {
                                <small class="text-muted mb-2">
                                    @{
                                        string categoryIcon = "fas fa-tag"; // default icon
                                        string categoryName = product.Category.Name.ToLower();
                                    }
                                    <i class="@categoryIcon me-1"></i>@product.Category.Name
                                </small>
                            }
                            <div class="card-text flex-grow-1">@Html.Raw(product.ShortDescription)</div>
                            <div class="mt-auto">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="h5 text-primary mb-0">@product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</span>
                                    <button class="btn btn-primary btn-sm add-to-cart-btn" 
                                            data-product-id="@product.Id"
                                            data-product-name="@product.Name">
                                        <i class="fas fa-shopping-cart me-1"></i>
                                        Thêm vào giỏ
                                        <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="text-center mt-4">
            <a asp-controller="Products" asp-action="Index" class="btn btn-outline-primary btn-lg">
                Xem tất cả sản phẩm
            </a>
        </div>
    </div>
}
else
{
    <div class="container mb-5">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="fw-bold">Sản phẩm nổi bật</h2>
                <p class="text-muted">Hiện chưa có sản phẩm nào</p>
                <a asp-area="Admin" asp-controller="Products" asp-action="Create" class="btn btn-primary">
                    Thêm sản phẩm đầu tiên
                </a>
            </div>
        </div>
    </div>
}

<!-- Why Choose Us -->
<div class="bg-light py-5">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-4">
                <h2 class="fw-bold">Tại sao chọn HWeb Fashion?</h2>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-md-4 text-center">
                <div class="mb-3">
                    <i class="fas fa-shipping-fast text-primary" style="font-size: 3rem;"></i>
                </div>
                <h5>Giao hàng nhanh</h5>
                <p class="text-muted">Giao hàng toàn quốc trong 1-2 ngày</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="mb-3">
                    <i class="fas fa-medal text-primary" style="font-size: 3rem;"></i>
                </div>
                <h5>Chất lượng cao</h5>
                <p class="text-muted">Sản phẩm chất lượng với giá cả hợp lý</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="mb-3">
                    <i class="fas fa-undo text-primary" style="font-size: 3rem;"></i>
                </div>
                <h5>Đổi trả dễ dàng</h5>
                <p class="text-muted">Hỗ trợ đổi trả trong vòng 7 ngày</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Handle add to cart button clicks
            $('.add-to-cart-btn').click(function() {
                const btn = $(this);
                const productId = btn.data('product-id');
                const productName = btn.data('product-name');
                const spinner = btn.find('.spinner-border');
                const btnText = btn.contents().not('.spinner-border');
                
                // Show loading state
                spinner.removeClass('d-none');
                btn.prop('disabled', true);
                
                // Add to cart via AJAX
                $.ajax({
                    url: '@Url.Action("AddToCart", "Cart")',
                    type: 'POST',
                    data: {
                        productId: productId,
                        quantity: 1
                    },
                    success: function(response) {
                        if (response.success) {
                            // Show success message
                            showToast('success', response.message);
                            
                            // Update cart count in navbar
                            if (window.updateCartCount) {
                                window.updateCartCount(response.cartCount);
                            }
                            
                            // Change button text temporarily
                            btn.html('<i class="fas fa-check me-1"></i>Đã thêm');
                            btn.removeClass('btn-primary').addClass('btn-success');
                            
                            // Reset button after 2 seconds
                            setTimeout(function() {
                                btn.html('<i class="fas fa-shopping-cart me-1"></i>Thêm vào giỏ<span class="spinner-border spinner-border-sm d-none" role="status"></span>');
                                btn.removeClass('btn-success').addClass('btn-primary');
                            }, 2000);
                        } else {
                            showToast('error', response.message);
                        }
                    },
                    error: function() {
                        showToast('error', 'Có lỗi xảy ra. Vui lòng thử lại.');
                    },
                    complete: function() {
                        // Hide loading spinner
                        spinner.addClass('d-none');
                        btn.prop('disabled', false);
                    }
                });
            });
        });

        function showToast(type, message) {
            // Simple toast implementation
            const toastClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const toast = $(`<div class="alert ${toastClass} alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 9999; max-width: 350px;">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`);
            
            $('body').append(toast);
            
            // Auto remove after 3 seconds
            setTimeout(function() {
                toast.alert('close');
            }, 3000);
        }
    </script>
}
