@model HWeb.Models.Product
@{
    ViewData["Title"] = Model.Name;
}

<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
            <li class="breadcrumb-item"><a asp-controller="Products" asp-action="Index">Sản phẩm</a></li>
            @if (Model.Category != null)
            {
                <li class="breadcrumb-item">@Model.Category.Name</li>
            }
            <li class="breadcrumb-item active" aria-current="page">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Image -->
        <div class="col-lg-5 mb-4">
            <div class="card">
                <div class="card-body p-0">
                    @if (!string.IsNullOrEmpty(Model.ImageUrl))
                    {
                        <div class="product-image-container" style="width: 100%; overflow: hidden;">
                            <img src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid w-100" style="display: block; height: auto;">
                        </div>
                    }
                    else
                    {
                        <div class="bg-light d-flex align-items-center justify-content-center" style="aspect-ratio: 1000/1500;">
                            <i class="fas fa-tshirt text-muted" style="font-size: 5rem;"></i>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Product Information -->
        <div class="col-lg-7">
            <div class="product-info">
                <h1 class="h3 mb-3">@Model.Name</h1>
                
                @if (Model.Category != null)
                {
                    <p class="text-muted mb-2">
                        <i class="fas fa-tag me-2"></i>
                        <strong>Danh mục:</strong> @Model.Category.Name
                    </p>
                }

                <div class="price mb-4">
                    <h2 class="text-primary mb-0">@Model.Price.ToString("N0")đ</h2>
                </div>

                @if (!string.IsNullOrEmpty(Model.ShortDescription))
                {
                    <div class="short-description mb-4">
                        <h5>Mô tả ngắn</h5>
                        <div class="text-muted">@Html.Raw(Model.ShortDescription)</div>
                    </div>
                }

                <!-- Quantity and Add to Cart -->
                <div class="add-to-cart-section mb-4">
                    <form id="addToCartForm">
                        <input type="hidden" id="productId" value="@Model.Id">
                        <div class="row align-items-end">
                            <div class="col-4">
                                <label for="quantity" class="form-label">Số lượng</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" value="1" min="1" max="99">
                            </div>
                            <div class="col-8">
                                <button type="submit" class="btn btn-primary btn-lg w-100" id="addToCartBtn">
                                    <i class="fas fa-shopping-cart me-2"></i>
                                    <span class="btn-text">Thêm vào giỏ hàng</span>
                                    <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Product Tags -->
                @if (Model.ProductTags != null && Model.ProductTags.Any())
                {
                    <div class="product-tags mb-4">
                        <h6>Thẻ sản phẩm</h6>
                        @foreach (var productTag in Model.ProductTags)
                        {
                            <span class="badge bg-secondary me-2 mb-2">@productTag.Tag.Name</span>
                        }
                    </div>
                }

                <!-- Product Actions -->
                <div class="product-actions">
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-outline-danger w-100" onclick="alert('Chức năng đang phát triển')">
                                <i class="fas fa-heart me-2"></i>
                                Yêu thích
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-info w-100" onclick="alert('Chức năng đang phát triển')">
                                <i class="fas fa-share me-2"></i>
                                Chia sẻ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Tab -->
    <div class="row mt-5">
        <div class="col-12">
            <ul class="nav nav-tabs" id="productTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                        Mô tả chi tiết
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
                        Thông số kỹ thuật
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                        Đánh giá
                    </button>
                </li>
            </ul>
            <div class="tab-content border border-top-0 p-4" id="productTabContent">
                <div class="tab-pane fade show active" id="description" role="tabpanel">
                    @if (!string.IsNullOrEmpty(Model.DetailDescription))
                    {
                        <div class="product-description">
                            @Html.Raw(Model.DetailDescription)
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">Chưa có mô tả chi tiết cho sản phẩm này.</p>
                    }
                </div>
                <div class="tab-pane fade" id="specifications" role="tabpanel">
                    <div class="specifications">
                        <table class="table table-striped">
                            <tbody>
                                <tr>
                                    <td><strong>Mã sản phẩm</strong></td>
                                    <td>SP-@Model.Id.ToString("D6")</td>
                                </tr>
                                <tr>
                                    <td><strong>Danh mục</strong></td>
                                    <td>@(Model.Category?.Name ?? "Chưa phân loại")</td>
                                </tr>
                                <tr>
                                    <td><strong>Giá bán</strong></td>
                                    <td>@Model.Price.ToString("N0")đ</td>
                                </tr>
                                <tr>
                                    <td><strong>Trạng thái</strong></td>
                                    <td><span class="badge bg-success">Còn hàng</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="reviews" role="tabpanel">
                    <div class="reviews">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Chức năng đánh giá sản phẩm đang được phát triển.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products -->
    <div class="row mt-5">
        <div class="col-12">
            <h3>Sản phẩm liên quan</h3>
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Chức năng hiển thị sản phẩm liên quan đang được phát triển.
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('addToCartForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const productId = document.getElementById('productId').value;
            const quantity = document.getElementById('quantity').value;
            const addToCartBtn = document.getElementById('addToCartBtn');
            const spinner = addToCartBtn.querySelector('.spinner-border');
            const btnText = addToCartBtn.querySelector('.btn-text');
            
            // Show loading spinner
            spinner.classList.remove('d-none');
            btnText.classList.add('d-none');
            addToCartBtn.disabled = true;
            
            // Add to cart via AJAX
            $.ajax({
                url: '@Url.Action("AddToCart", "Cart")',
                type: 'POST',
                data: {
                    productId: productId,
                    quantity: quantity
                },
                success: function(response) {
                    if (response.success) {
                        // Show success message
                        showToast('success', response.message);
                        
                        // Update cart count in navbar
                        updateCartCount(response.cartCount);
                        
                        // Reset form
                        document.getElementById('quantity').value = 1;
                    } else {
                        showToast('error', response.message);
                    }
                },
                error: function() {
                    showToast('error', 'Có lỗi xảy ra. Vui lòng thử lại.');
                },
                complete: function() {
                    // Hide loading spinner
                    spinner.classList.add('d-none');
                    btnText.classList.remove('d-none');
                    addToCartBtn.disabled = false;
                }
            });
        });

        function updateCartCount(count) {
            const cartCountElements = document.querySelectorAll('.cart-count');
            cartCountElements.forEach(element => {
                element.textContent = count;
                if (count > 0) {
                    element.style.display = 'inline';
                } else {
                    element.style.display = 'none';
                }
            });
        }

        function showToast(type, message) {
            // Simple toast implementation
            const toastClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const toast = document.createElement('div');
            toast.className = `alert ${toastClass} alert-dismissible fade show position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(function() {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 3000);
        }
    </script>
}
